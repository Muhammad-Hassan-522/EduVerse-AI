<app-modal-shell
  [show]="show"
  [title]="editingAssignmentId ? 'Edit Assignment' : 'Create New Assignment'"
  [actionLabel]="
    editingAssignmentId ? 'Update Assignment' : 'Create Assignment'
  "
  [isFormValid]="assignmentForm.valid"
  (close)="closeModal()"
  (submit)="submitForm()"
>
  <form
    [formGroup]="assignmentForm"
    (ngSubmit)="submitForm()"
    class="p-6 space-y-6"
  >
    <!-- Title -->
    <div>
      <label class="block text-sm font-semibold text-primary-navy mb-2"
        >Assignment Title *</label
      >
      <input
        type="text"
        formControlName="title"
        class="w-full px-4 py-3 border border-border-light rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-light-blue"
        placeholder="e.g., Web Development Final Project"
      />
      <p
        *ngIf="
          assignmentForm.get('title')?.touched &&
          assignmentForm.get('title')?.invalid
        "
        class="text-red-500 text-sm mt-1"
      >
        Title is required.
      </p>
    </div>

    <!-- Course Selection -->
    <div>
      <label class="block text-sm font-semibold text-primary-navy mb-2"
        >Select Course *</label
      >
      <select
        formControlName="course"
        class="w-full px-4 py-3 border border-border-light rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-light-blue"
      >
        <option value="">Choose a course</option>
        <option *ngFor="let course of courses" [value]="course">
          {{ course }}
        </option>
      </select>
      <p
        *ngIf="
          assignmentForm.get('course')?.touched &&
          assignmentForm.get('course')?.invalid
        "
        class="text-red-500 text-sm mt-1"
      >
        Course selection is required.
      </p>
    </div>

    <!-- Description -->
    <div>
      <label class="block text-sm font-semibold text-primary-navy mb-2"
        >Description *</label
      >
      <textarea
        formControlName="description"
        rows="4"
        class="w-full px-4 py-3 border border-border-light rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-light-blue resize-none"
        placeholder="Describe the assignment requirements..."
      ></textarea>
      <p
        *ngIf="
          assignmentForm.get('description')?.touched &&
          assignmentForm.get('description')?.invalid
        "
        class="text-red-500 text-sm mt-1"
      >
        Description is required.
      </p>
    </div>

    <!-- Date & Time -->
    <div class="grid md:grid-cols-2 gap-4">
      <!-- Due Date -->
      <div>
        <label class="block text-sm font-semibold text-primary-navy mb-2"
          >Due Date *</label
        >
        <input
          type="date"
          formControlName="dueDate"
          class="w-full px-4 py-3 border border-border-light rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-light-blue"
        />
        <p
          *ngIf="
            assignmentForm.get('dueDate')?.touched &&
            assignmentForm.get('dueDate')?.invalid
          "
          class="text-red-500 text-sm mt-1"
        >
          <span *ngIf="assignmentForm.get('dueDate')?.errors?.['required']"
            >Due date is required.</span
          >
        </p>
      </div>

      <!-- Due Time -->
      <div>
        <label class="block text-sm font-semibold text-primary-navy mb-2"
          >Due Time *</label
        >
        <input
          type="time"
          formControlName="dueTime"
          class="w-full px-4 py-3 border border-border-light rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-light-blue"
        />
        <p
          *ngIf="
            assignmentForm.get('dueTime')?.touched &&
            assignmentForm.get('dueTime')?.invalid
          "
          class="text-red-500 text-sm mt-1"
        >
          <span *ngIf="assignmentForm.get('dueTime')?.errors?.['required']"
            >Due time is required.</span
          >
        </p>
      </div>
    </div>

    <!-- Marks -->
    <div class="grid md:grid-cols-2 gap-4">
      <!-- Total Marks -->
      <div>
        <label class="block text-sm font-semibold text-primary-navy mb-2"
          >Total Marks *</label
        >
        <input
          type="number"
          formControlName="totalMarks"
          min="1"
          max="100"
          class="w-full px-4 py-3 border border-border-light rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-light-blue"
          placeholder="100"
        />
        <p
          *ngIf="
            assignmentForm.get('totalMarks')?.touched &&
            assignmentForm.get('totalMarks')?.invalid
          "
          class="text-red-500 text-sm mt-1"
        >
          <span *ngIf="assignmentForm.get('totalMarks')?.errors?.['required']"
            >Total marks is required.</span
          >
          <span *ngIf="assignmentForm.get('totalMarks')?.errors?.['min']"
            >Must be at least 1.</span
          >
          <span *ngIf="assignmentForm.get('totalMarks')?.errors?.['max']"
            >Cannot exceed 100.</span
          >
        </p>
      </div>

      <!-- Passing Marks -->
      <div>
        <label class="block text-sm font-semibold text-primary-navy mb-2"
          >Passing Marks *</label
        >
        <input
          type="number"
          formControlName="passingMarks"
          min="1"
          max="100"
          class="w-full px-4 py-3 border border-border-light rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-light-blue"
          placeholder="40"
        />
        <p
          *ngIf="
            assignmentForm.get('passingMarks')?.touched &&
            assignmentForm.get('passingMarks')?.invalid
          "
          class="text-red-500 text-sm mt-1"
        >
          <span *ngIf="assignmentForm.get('passingMarks')?.errors?.['required']"
            >Passing marks is required.</span
          >
          <span *ngIf="assignmentForm.get('passingMarks')?.errors?.['min']"
            >Must be at least 1.</span
          >
          <span *ngIf="assignmentForm.get('passingMarks')?.errors?.['max']"
            >Cannot exceed 100.</span
          >
          <span
            *ngIf="assignmentForm.get('passingMarks')?.errors?.['passingGreaterThanTotal']"
            >Cannot be greater than total marks.</span
          >
        </p>
      </div>
    </div>

    <!-- File Upload -->
    <div>
      <label class="block text-sm font-semibold text-primary-navy mb-2"
        >Attachments</label
      >
      <div
        class="border-2 border-dashed border-border-light rounded-xl p-6 text-center hover:border-primary-light-blue transition-colors"
      >
        <input
          type="file"
          multiple
          (change)="handleFileUpload($event)"
          class="hidden"
          id="file-upload"
        />
        <label for="file-upload" class="cursor-pointer block">
          <i class="fa-solid fa-upload text-text-muted text-3xl mb-2"></i>
          <p class="text-text-muted text-sm">
            Click to upload or drag and drop
          </p>
        </label>
      </div>

      <div *ngIf="attachments.controls.length > 0" class="mt-3 space-y-2">
        <div
          *ngFor="let fileCtrl of attachments.controls; let i = index"
          class="flex items-center justify-between bg-gray-50 px-4 py-2 rounded-lg"
        >
          <span class="text-sm text-primary-navy">{{
            fileCtrl.value.name
          }}</span>
          <app-button
            (buttonClick)="removeAttachment(i)"
            [customColor]="
              'text-red-600 hover:text-red-700 hover:bg-transparent'
            "
            [class]="'p-0'"
          >
            <i class="fa-solid fa-trash text-sm"></i>
          </app-button>
        </div>
      </div>
    </div>

    <!-- Allow Late Submission -->
    <div class="flex items-center gap-3">
      <input
        type="checkbox"
        formControlName="allowLateSubmission"
        class="w-5 h-5 text-primary-light-blue rounded focus:ring-2 focus:ring-primary-light-blue cursor-pointer"
      />
      <label class="text-sm text-primary-navy font-medium cursor-pointer"
        >Allow late submissions</label
      >
    </div>
  </form>
</app-modal-shell>
